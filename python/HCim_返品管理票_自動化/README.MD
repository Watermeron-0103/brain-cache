# HCim 返品管理票 自動化メモ

このリポジトリは、富士フイルム HCim ポータルで「返品管理票」の検索結果を自動操作で取得し、CSV形式でエクスポートするための備忘録です。Selenium を用いたスクレイピングスクリプトと、その操作を簡易的なウェブUIから実行できる Flask アプリケーションを収録しています。

## 1. 返品管理票のスクレイピング

[`returns_form.py`](./returns_form.py) には、HCim ポータル上の「部品品記検索一覧」画面から返品管理票を検索し、CSVをダウンロードするためのスクリプトが含まれています。主な流れは次の通りです。

1. **ポータルにアクセス** — 事前にブラウザでログインした状態を想定します。
2. **メニュー遷移** — 「ワークフロー」→「不具合情報システム」→「部品品記」→「部品品記検索一覧」へマウスホバーとクリックで移動します。
3. **文書種別の設定** — 独自UIを操作し、「返品管理票」を選択します。内部的には隠し`<select>`と表示用テキストボックスの両方を更新します。
4. **ステータスを全選択** — 「承認中／差戻／引戻／取止／完了」のチェックボックスを全てONにします。
5. **起票日の指定** — `apply_dt_from_display` および `apply_dt_to_display` というテキストボックスに日付文字列を書き込み、`input`/`change`イベントを発火させます。日付ピッカーは使用しません。
6. **検索ボタン押下** — 検索結果を取得します。画面下部の jqGrid に結果が表示されます。
7. **CSVボタン押下 → 確認OK** — CSV出力ボタンをクリックすると確認ダイアログが表示されます。`OK` ボタンをクリックしてエクスポートを実行します。
8. **ダウンロード待ち** — Chrome のダウンロードフォルダを監視し、`.crdownload` が消えたらCSVファイルを確定します。必要に応じてファイル名を変更します。

スクリプトはデフォルトでは `/output` ディレクトリにダウンロードします。ヘッドレスモードでも動作するよう、Chrome DevTools protocol でダウンロードパスを設定しています。

### 実行方法（単体）

```bash
pip install selenium pandas
python returns_form.py
